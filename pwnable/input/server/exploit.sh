#!/bin/bash

BASE_PATH="/tmp/server"
# cd ~/

# stage 5
(sleep 3; (echo -e "\xde\xad\xbe\xef" | nc localhost 9999)) &

# stage 4
echo -en "\x00\x00\x00\x00" >$BASE_PATH/$'\n'

# stage 2
exec 2>&-; echo -e "\x00\x0a\x02\xff" >$BASE_PATH/stderr; exec 2<$BASE_PATH/stderr

# stage 1
echo -en "\x00\x0a\x00\xff" | ./input  $(seq 1 64) '' "$(echo -ne " \n\r")" '9999' $(seq 68 99)

rm -f -- $'\n' $PATH/stderr

