#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>

int main(int argc, char* argv[], char* envp[]) {

  if (argc < 3) {
    puts("first arugments must path");
    exit(2);
  }
  
  *envp = "\xde\xad\xbe\xef\x3d\xca\xfe\xba\xbe";
  char* path = argv[1];
  char* execfile = argv[2];
  char* newpath = (char *)malloc((strlen(path) + 6));
  char* execpath = (char *)malloc((strlen(path) + strlen(execfile) + 2));
  strcat(newpath, path);
  strcat(newpath, "/pip");
  strcat(execpath, path);
  strcat(execpath, "/");
  strcat(execpath, execfile);
  int fd = open(newpath, O_RDWR | O_CREAT, S_IRUSR | S_IWUSR);
  char *newargv[] = {"/bin/bash", "-c", execpath, 0};
  dup2(fd, 1);
  dup2(fd, 2);
  close(fd);
  execve("/bin/bash", &newargv[0], envp);
  free(newpath);
  free(execpath);
}
